# 4.1 데이터베이스의 기본

### **데이터베이스란?**

: 일정한 규칙(규약)을 통해 구조화되어 저장되는 데이터의 모음.

- EX. 항공기 예약 시스템에서 항공기 좌석 예약 시 모든 예약 정보가 데이터베이스에 저장.
- 데이터베이스는 실시간 접근과 동시 공유가 가능하다.

### **DBMS( DataBase Management System ) 란?**

: 데이터베이스를 제어, 관리하는 통합 시스템.

- DBMS마다 정의된 쿼리 언어를 통해 데이터를 삽입, 삭제, 수정, 조회 등을 수행할 수 있다.
- EX. MySQL, PostgreSQL, 오라클, SQL Server, MSSQL

→ 이거 DBMS가 맞지? 책에서 DB라고 나와서 한 번씩 헷갈린다

## 4.1.1. 엔터티

---

### 엔터티(Entity)란?

: 여러 개의 속성을 지닌 명사

EX. 사람, 장소, 물건, 사건, 개념 등 → 회원, 구매, 교수, 학생 정도로 생각!

### 약한 엔터티와 강한 엔터티

A가 혼자서 존재하지 못하고 B의 존재 여부에 따라 종속적인 경우

→ A: 약한 엔터티 / B: 강한 엔터티

## 4.1.2. 릴레이션

---

### 릴레이션(Relation)이란?

: 데이터베이스에서 정보를 구분하여 저장하는 기본 단위

- 엔터티를 데이터베이스에서 관리할 때, 엔터티는 릴레이션에 매핑된다.
- 릴레이션의 명칭
    - 관계형 데이터베이스 → 테이블
    - NoSQL 데이터베이스 → 컬렉션

## 4.1.3. 속성

---

### 속성(Attribute)이란?

: 릴레이션에서 관리하는 구체적이며 고유한 이름을 갖는 정보.

## 4.1.4. 도메인

---

### 도메인(Domain)이란?

: 릴레이션에 포함된 각각의 속성들이 가질 수 있는 값의 집합.

EX. 속성 ‘성별’의 도메인 → {남, 여}

## 4.1.5. 필드와 레코드

---

### 레코드(Record)란?

: 테이블의 행(row)의 단위의 데이터. 

= 튜플(Tuple)

### 필드(Field)란?

: 속성(Attribute).

### 필드 타입(MySQL 기준)

1. **숫자 타입**
    - TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT
    - 위의 숫자 타입은 순서대로 1,2,3,4,5 바이트의 크기를 갖는다.
2. **날짜 타입**
    1. DATE : 날짜 O, 시간 X.  3바이트의 용량.
    2. DATETIME : 날짜 O, 시간 O.  8바이트의 용량.
    3. TIMESTAMP : 날짜 O, 시간 O.  4바이트의 용량.
3. **문자 타입**
    1. CHAR & VARCHAR
        1. CHAR : 고정 길이 문자열. 레코드 저장 시 미리 선언한 길이 값으로 저장된다.
            - EX. CHAR(100)으로 선언 → 10바이트 크기의 문자열을 저장해도 100바이트로 저장된다.
        2. VARCHAR : 가변 길이 문자열. 입력된 데이터의 용량에 맞추어 저장한다.
            - EX. VARCHAR(100)으로 선언 → 10바이트 크기의 문자열 저장 시 11바이트로 저장된다.
            - Q. 왜 10바이트가 아니라 11바이트일까?
                
                :  10바이트 + **길이 기록용 1바이트**도 함께 저장하기 때문. 
                
        - CHAR → 고정된 길이를 가진 데이터의 경우에 효율적 EX. 성별 / 주민등록번호
        - VARCHAR → 유동적인 길이를 가진 데이터의 경우에 효율적 EX. 이름 / 주소
    2. TEXT & BLOB
        
        : 큰 데이터 저장 시 활용.
        
        1. TEXT : 큰 문자열 저장. EX. 게시판 본문 저장
        2. BLOB : 이미지, 동영상 등 큰 데이터 저장. 
            - 보통 AWS S3 등에 파일 원본을 업로드 하고 파일의 경로를 VARCHAR로 저장한다.
    3. ENUM & SET
        
        : 문자열을 열거한 타입.
        
        - 장점 : 공간적 이점
        - 단점 : 애플리케이션의 수정에 따라 ENUM/SET에 정의한 목록을 수정해야 한다.
        1. ENUM
            - 형태 : ENUM(’X-SMALL’, ‘SMALL’, ‘MEDIUM’, ‘LARGE’, ‘X-LARGE’)
            - ENUM 리스트 중 하나만 선택 가능.
            - ENUM 리스트에 없는 값 삽입 시 빈 문자열이 대신 삽입됨.
            - 메모리를 적게 사용하는 이점이 있다.
        2. SET
            - 여러 개 선택 가능.
            - 비트 단위의 연산 가능.
            - 최대 64개의 요소를 집어넣을 수 있음.
    

## 4.1.6. 관계

---

### 관계란?

:  데이터베이스 내의 테이블이 가지는 관계. 

### 관계의 종류

1. 1 : 1 관계
    - 한 개체가 하나의 개체를 포함하는 관계
    - EX. 유저와 이메일의 관계
2. 1 : N 관계
    - 한 개체가 다른 많은 개체를 포함하는 관계
    - EX. 유저와 상품의 관계
3. M : N 관계
    - 양방향으로 1 : N의 관계를 갖는 것.
    - EX. 학생과 강의의 관계. 학생도 여러 강의를 들을 수 있으며 한 강의에 여러 명의 학생이 포함됨.
    - M : N 관계는 두 테이블을 직접 연결하지 않고 중간에 테이블을 하나 두어 이 테이블과 각각 
    1 : N, 1 : M의 관계를 맺도록 한다.

## 4.1.7. 키

---

### 키(KEY)란?

: 각 튜플을 고유하게 식별할 수 있는 하나 이상의 애트리뷰트들의 집합.

### 키(KEY)의 종류

- 유일성 : 각 튜플을 고유하게 식별할 수 있음.
1. 슈퍼키 : 유일성을 만족하는 키.
2. 후보키 : 슈퍼키 중 최소성을 만족하는 키. 유일성과 최소성 모두 만족.
3. 기본키 : 후보키 중의 하나.
4. 대체키 : 기본키가 아닌 모든 후보키.
5. 외래키 :  다른 테이블의 기본키를 참조하는 값.

### 기본키 (PK, Primary Key)

1. 자연키
    - 테이블에서 중복된 값이 들어올 수 있는 애트리뷰트를 제외하다가 나오는 키
    - 언젠가 변할 수 있다.
2. 인조키
    - 인위적으로 부여한 식별자. 보통 일련번호.
    - Oracle → sequence , MySQL → auto increment 등으로 설정.
    - 값이 변하지 않는다.
- 보통 인조키를 기본키로 설정한다.

### 외래키 (FK, Foreign Key)

: 다른 테이블의 기본키를 그대로 참조하는 값.

- 관계 식별 시 사용하는 값.
- 외래키는 중복되어도 괜찮다.

# 4.2 ERD와 정규화 과정

## 4.2.1. ERD의 중요성

---

- ERD(Entity Relationship Diagram) : 시스템의 요구 사항을 기반으로 작성 & ERD를 기반으로 DB 구축
- 장점 : 관계형 구조로 표현할 수 있는 데이터 구성 시 유용.
- 단점 : *비정형 데이터를 충분히 표현할 수 없음.
    - 비정형 데이터 : Unstructured data. 미리 정의된 방식으로 정리되지 않은 정보 / 미리 정의된 데이터 모델이 없는 경우.
        - EX. 텍스트, 이미지, 동영상 등

## 4.2.3. 정규화 과정

---

### 정규화 과정?

: 릴레이션을 여러 개로 분리하는 과정.

- 왜 할까?
    - 데이터베이스 이상 현상을 해결하기 위해
    - 저장 공간을 효율적으로 사용하기 위해

### 데이터베이스 이상 현상

- 삽입 이상 : 불필요한 정보를 함께 저장하지 않고는 어떤 정보를 저장하는 것이 불가능
- 삭제 이상 : 유용한 정보를 함께 삭제하지 않고는 어떤 정보를 삭제하는 것이 불가능
- 갱신 이상 : 반복된 데이터 중 일부만 수정하면 데이터 불일치 발생

### 함수적 종속성

- 결정자 : 다른 애트리뷰트의 값을 고유하게 결정하는 애트리뷰트 값.
- A → B
    
    : A가 B를 결정한다.
    
    : A의 속성값에 대해 반드시 하나의 B 속성값이 대응된다.
    
    : B는 A에 함수적으로 종속한다.
    
    - A : 결정자 / B : 종속자
- **함수적 종속성의 종류**
    - 완전 함수 종속성 : 기본키에 함수적으로 종속 + 기본키의 부분집합에는 함수적으로 종속X.
    - 부분 함수 종속성 : 기본키를 구성하는 속성에 함수적으로 종속하는 경우.
    - 이행 함수 종속성 : A → B & B → C  >> A → C 만족

### 제1정규형

: 모든 도메인이 더이상 분해될 수 없는 원자 값으로 구성되어야함.

### 제2정규형

: 제1정규형을 만족하며 부분 함수의 종속성이 제거된 형태. 즉, 완전 함수 종속성을 만족한 형태.

### 제3정규형

: 제2정규형을 만족하며 기본키가 아닌 모든 속성이 이행적 함수 종속을 만족하지 않는 상태.

### 보이스/코드 정규형(BCNF)

: 제3정규형을 만족하며 모든 결정자가 후보 키여야한다.

# 4.3 트랜잭션과 무결성

## 4.3.1. 트랜잭션

---

### 트랜잭션(Transaction)이란?

: 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위.

→ 여러 개의 쿼리를 하나로 묶는 단위.

### 트랜잭션의 특징 = ACID 특징

1. 원자성(Atomicity) : All or nothing. 트랜잭션과 관련된 일이 모두 수행되거나 되지 않거나를 보장.
    - 커밋(Commit) : 쿼리가 성공적으로 처리되었다고 확정하는 명령어.
        - 트랜잭션 단위로 수행
        - 변경된 내용이 모두 영구적으로 저장됨.
    - 롤백(Rollback) : 트랜잭션으로 처리한 과정을 일어나기 전으로 되돌리는 일.
    
    → 커밋과 롤백을 통한 무결성 보장.
    
2. 일관성(Consistency) : 허용된 방식으로만 데이터를 변경해야하는 것.
3. 격리성(Isolation) : 트랜잭션 수행 시 서로 끼어들 수 없는 것.
    - 격리 수준
        1. SERIALIZABLE : 트랜잭션을 순차적으로 진행하는 것.
            - 여러 트랜잭션이 동시에 같은 행에 접근할 수 없음.
            - 교착 상태 발생 확률이 높고 성능이 떨어짐.
        2. REPEATABLE_READ
            - 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 없음.
            - 새로운 행을 추가하는 것은 막을 수 없음.
                
                → **팬텀 리드** 발생 가능.
                
        3. READ_COMMITTED
            - 다른 트랜잭션이 커밋하지 않은 정보를 읽을 수 없음.
            - 커밋 완료된 데이터에 대해서만 조회 허용.
            - 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 있음.
                
                → **팬텀 리드, 반복 가능하지 않은 조회** 발생 가능.
                
        4. READ_UNCOMMITTED
            - 가장 빠름.
            - 하나의 트랜잭션이 커밋되기 이전에 다른 트랜잭션에 노출될 수 있음.
                
                → **팬텀 리드, 반복 가능하지 않은 조회, 더티 리드** 발생 가능.
                
    - 격리 수준에 따라 발생하는 현상
        1. 팬텀 리드 : 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 조회 결과가 다른 경우. 
            - EX. A가 q 쿼리를 통해 조회 → 3개의 행 조회 / B가 데이터 삽입 / A가 q 쿼리를 통해 조회 → 4개의 행 조회
        2. 반복 가능하지 않은 조회 : 같은 행에 두 번 이상의 조회를 했는데 그 값이 다른 경우.
        3. 더티 리드 : 한 트랜잭션이 실행 중일 때, 다른 트랜잭션에 의해 수정되었지만 ‘커밋되지 않은’ 행의 값이 결과로 나오는 경우
        - Q. 팬텀 리드와 반복 가능하지 않은 조회의 차이
        - A. 팬텀 리드는 **선택되는 행 자체**가 다를 수 있지만,  반복 가능하지 않은 조회는 **행 값**이 달라질 수 있음.
4. 지속성(Durability) : 성공적으로 수행된 트랜잭션이 영원히 반영되어야 하는 것.
    - 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 함.
    - 이를 위한 기능 : 체크섬, 저널링, 롤백

## 4.3.2. 무결성

---

: 데이터의 정확성, 일관성, 유효성을 유지하는 것.

### 무결성의 특징

1. 개체 무결성 : 기본키 필드는 NULL 값을 갖지 않는다.
2. 참조 무결성 : 참조 관계에 있는 두 테이블의 데이터는 일관되게 유지되어야 한다.
3. 고유 무결성 : 특정 속성에 대해 고유한 값을 가지도록 조건이 정해졌다면 고유한 값을 가져야 한다.
4. NULL 무결성 : 특정 속성에 NULL 값이 없다는 조건이 주어진 경우 그 속성 값은 NULL 값을 가질 수 없다.

# 4.4. 데이터베이스의 종류

## 4.4.1. 관계형 데이터베이스

---

### 관계형 데이터베이스(RDBMS)란?

: 행과 열을 가지는 표 형식의 데이터를 저장하는 형태의 데이터베이스

- SQL 언어를 통해 조작한다.
- EX. MySQL, PostgreSQL, 오라클, SQL Server, MSSQL 등

### MySQL

- 구조 : 레코드 - 테이블 - 데이터베이스

## 4.4.2. NoSQL 데이터베이스

---

 : SQL을 사용하지 않는 데이터베이스

- EX. MongoDB, Redis

### MongoDB

: JSON을 통해 데이터에 접근할 수 있다.

- key-value 데이터 모델에서 확장된 도큐먼트 기반의 DB.
- 구조 : 도큐먼트 - 컬렉션 - 데이터베이스
